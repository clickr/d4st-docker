<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>BaseX: Enabling Search and Link Management</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="schema.DC" href="http://purl.org/dc/terms/"><meta name="DC.Type" content="topic"><meta name="description" content="The BaseX system is an XQuery-based XML database that provides powerful search features for XML."><meta name="DC.Creator" content="W. Eliot Kimber"><meta name="rights" content="© 2014 W. Eliot Kimber"><meta name="DC.Date.Created" content="2014-08-23"><meta name="DC.Date.Modified" content="2014-08-23"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="topic_qm1_rg2_lr"><script type="text/javascript">var d4p = {"relativePath":"..\/","dev":false,"debug":false,"draft":false,"nextTopicHref":"topics\/tools-exist-db.html","previousTopicHref":"topics\/tools-git.html","ext":".html","root":false,"topic":{"chunked":""},"map":{"title":"DITA For Small Teams","chunked":false},"search":{"minlength":2},"l":{"searchPageHeading":"Search Results","close":"Close"}}</script><link rel="stylesheet" type="text/css" media="screen, projection" href="../themes/dita-d4p-classic/css/style.css"><link rel="stylesheet" type="text/css" media="screen, projection, print" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"><script type="text/javascript">
      
        d4p.cssGridPath = d4p.dev ? 'html5-themes/modules/960-Responsive-Grid/css/' : 'themes/dita-d4p-classic/css/';
        var ADAPT_CONFIG = {
          // Where is your CSS?
          path: d4p.relativePath + d4p.cssGridPath,
          
          // false = Only run once, when page first loads.
          // true = Change on window resize and page tilt.
          dynamic: true,
          
          // Optional callback... myCallback(i, width)
          callback: doc_resize,
          
          // First range entry is the minimum.
          // Last range entry is the maximum.
          // Separate ranges by "to" keyword.
          range: [
             // small (size-0)
            '0px    to 760px  = mobile.css',
             // medium (size-1, size-2)
            '760px  to 980px  = 720.css',
            '980px  to 1270px = 960.css',
             // large (size-3, size-5)
            '1270px to 1600px = 1200.css',
            '1600px to 1940px = 1560.css',
             // extra large (size-6)
            '1940px to 2540px = 1920.css',
            '2540px           = 2520.css'
          ]
        };

        function doc_resize(i, width)
        {
          d4p.setBodyClassfunction(i, width);
        }


        
      </script><script type="text/javascript" src="../themes/dita-d4p-classic/js/script.js"></script></head><body class="en-us dita-d4p-classic centered navigation-default"><div id="d4h5-main-container" class="container_12" role="application"><header role="banner" aria-labelledby="publication-title" class="hide-for-small"><div class="grid_8"><h1 id="publication-title">DITA For Small Teams</h1></div><section class="grid_4 search-box"><form id="search" role="search"><div class="form-group"><input id="search-text" type="text" autocomplete="off" class="form-control" placeholder="Search"></div></form></section><secion class="clearfix"></secion></header><div id="d4h5-section-container" class="grid_12"><nav id="local-navigation" class="grid_4 alpha omega" role="navigation" aria-label="Main navigation"><div id="nav-content"><ul><li><a href="../index.html">Table of Contents</a></li><li class="collapsible active"><a href="dita-for-small-teams.html">DITA For Small Teams</a><ul><li class="collapsible active"><a href="dfst-tools.html">DITA for Small Teams Tools</a><ul><li><a href="tools-git.html">git: Distributed and Shared Access to Content</a></li><li class=" active"><a href="tools-basex.html" class=" selected">BaseX: Enabling Search and Link Management</a></li><li><a href="tools-exist-db.html">eXist-db: Enabling Search and Link Management</a></li><li><a href="tools-dita-ot.html">DITA Open Toolkit: General DITA Publishing and Data Processing</a></li></ul></li></ul></li></ul></div></nav><div id="d4h5-main-content" class="grid_8 alpha omega"><article><nav id="content-toolbar" class="toolbar hide-for-small"></nav><section id="page"><div><a id="topic_qm1_rg2_lr" class="anchor"></a> <h1 class="title topictitle1">BaseX: Enabling Search and Link Management</h1> <div class="body"><p class="shortdesc">The BaseX system is an XQuery-based XML database that provides powerful search features for XML.</p> <p class="p">The D4ST model uses an XQuery database to provide link management and DITA-aware search features. Any XQuery database can be used bu the D4ST project provides materials for using the BaseX database. Note that in the D4ST model, the XQuery database is used only as a read-only database to enable search and link management, it is <strong class="ph b">not</strong> used to manage the source documents. Source document management is done in a separate source code repository (e.g., git) that provides the required version control and distributed access features.</p> <p class="p">BaseX is a light-weight, pure-Java XQuery database that is easy to install and use, making it appropriate for use on individual Authors' workstations. It provides a built-in Web server as well as a general database server that can be accessed using special BaseX clients.</p> <p class="p">DITA content is loaded to BaseX through the use of git commit hooks (provided by the DITA for Small Teams project) that load the DITA content to the BaseX repository whenever it is committed to the git repository. These commit hooks keep the BaseX repository in sync with the main content repository.</p> <p class="p">The D4ST uses the BaseX HTTP server, which provides both a standard BaseX server and an HTTP server that enables Web access to the database.</p> <div class="p">The basic process for setting up BaseX is:<ol class="ol" id="topic_qm1_rg2_lr__ol_eh4_5gk_lr"> <li class="li">Install the BaseX HTTP server package</li> <li class="li">Set the BaseX configuration file so DITA documents are parsed correctly against the DITA DTDs managed by a DITA Open Toolkit.</li> <li class="li">Start the BaseX HTTP server</li> <li class="li">Set up the BaseX git hooks to automatically copy documents to the BaseX database</li> <li class="li">Test your setup to make sure everything is hooked up correctly</li> </ol></div> <p class="p">Once you have BaseX running you can test the configuration using a temporary database. It's easy to create a new database and add documents to it using the BaseX command-line client or the BaseX Web adminstration client.</p> </div> <section class="topic" id="topic_kky_g32_lr"> <h2 class="title topictitle2">Install BaseX</h2> <div class="body"> <p class="p">Installers are available for Windows (.exe download) and Mac (via Homebrew). You can also download the Zip package and simply unzip it somewhere and add the <span class="ph filepath">bin/</span> directory to your PATH environment variable.</p> <p class="p">The build-in BaseX user is "admin" with a password of "admin". If security is a concern you should at least change the administrator password if not create a separate user account for use by the git commit hooks.</p> <aside class="note note "><span class="title">Note:</span> If you are installing on Windows, the BaseX shell scripts will not be installed. However, these scripts can be used from the git command window that is part of the git Windows support. You can get these scripts from the BaseX Zip distribution and simply copy them into the BaseX bin directory.</aside> </div> </section> <section class="topic" id="topic_jgj_ndk_lr"> <h2 class="title topictitle2">One-Time BaseX Setup</h2> <div class="body"> <p class="p">In order to manage DITA documents properly, BaseX must be configured to use an XML catalog and to turn on DTD parsing. For DITA use you will normally use the <span class="ph filepath">catalog-dita.xml</span> file maintained by the DITA Open Toolkit. </p> <p class="p">To configure BaseX to parse DITA documents, update the BaseX configuration file <span class="ph filepath">.basex</span> in the BaseX installation directory:</p> <ol class="ol" id="topic_jgj_ndk_lr__ol_xkc_tdk_lr"> <li class="li">Find the location of the DITA Open Toolkit you will use to manage the master XML catalog file for your DITA documents.<p class="p">If this is the Open Toolkit integrated with oXygenXML, the toolkit will be in the <span class="ph filepath">frameworks/dita/DITA-OT</span> directory under the oXygenXML installation directory.</p><p class="p">You will need the absolute path of the Open Toolkit directory, e.g., <span class="ph filepath">/Applications/oxygen/frameworks/dita/DITA-OT</span> or <span class="ph filepath">C:\Program Files\Oxygen XML Editor 16\frameworks\dita\DITA-OT</span>.</p></li> <li class="li">Find the BaseX installation directory.<p class="p">The exact location will depend on your operating system and how you installed it. The default location on Windows is <span class="ph filepath">C:\Program Files (x86)\BaseX</span>. For OS X and Linux the command <samp class="ph codeph">which basexhttp</samp> should show the location (the value returned will include the <span class="ph filepath">bin/</span> directory—you want the parent of the <span class="ph filepath">bin/</span> directory).</p></li> <li class="li">Edit the file <span class="ph filepath">.basex</span> in a text editor and add the following lines at the end of the file:<pre class="pre codeblock">CATFILE = <var class="keyword varname">OT directory</var>/catalog-dita.xml
DTD = true
CHOP = false</pre><p class="p">Where <var class="keyword varname">OT directory</var> is the Open Toolkit directory you got in Step 1.</p><div class="p">On OS X, my .basex file looks like this:<pre class="pre codeblock"># General Options
DEBUG = false
DBPATH = /Users/ekimber/apps/basex/data
REPOPATH = /Users/ekimber/apps/basex/repo
LANG = English
LANGKEYS = false
GLOBALLOCK = false

# Client/Server Architecture
HOST = localhost
PORT = 1984
SERVERPORT = 1984
EVENTPORT = 1985
USER = 
PASSWORD = 
SERVERHOST = 
PROXYHOST = 
PROXYPORT = 0
NONPROXYHOSTS = 
TIMEOUT = 30
KEEPALIVE = 600
PARALLEL = 8
LOG = true
LOGMSGMAXLEN = 1000

# HTTP Services
WEBPATH = /Users/ekimber/apps/basex/webapp
RESTXQPATH = 
HTTPLOCAL = false
STOPPORT = 8985
AUTHMETHOD = Basic

# Local Options
CATFILE = /Applications/oxygen/frameworks/dita/DITA-OT/catalog-dita.xml
DTD = true
CHOP = false</pre></div><div class="p">On Windows, the CATFILE option looks like this:<pre class="pre codeblock">CATFILE = C:\Program Files\Oxygen XML Editor 16\frameworks\dita\DITA-OT\catalog-dita.xml</pre></div></li> <li class="li">Save the file.</li> </ol> <p class="p">To test this configuration you'll need to have a database, add a DITA document to it, and verify that all the default attributes were expanded on load. One indication that the configuration is correct is if it takes noticeable time to load DITA documents: BaseX has to fetch the DTDs and parse the documents with respect to them, which is much slower than just loading the XML without validating first.</p> <p class="p">There is one remaining setup task for which you need a running BaseX server: installing the D4ST XQuery modules.</p> </div> </section> <section class="topic" id="topic_ayl_c3j_lr"> <h2 class="title topictitle2">Start the BaseX HTTP Server</h2> <div class="body"> <p class="p">The D4ST setup uses BaseX in two ways: through git commit hooks that update XML documents in the BaseX database and through a Web application that enables search and provides DITA link management services.</p> <p class="p">To support this dual use of BaseX you must run the BaseX HTTP server. The BaseX HTTP server then provides both the BaseX server (accessed through BaseX clients, such as the BaseX command-line client) and the BaseX HTTP server. You can run the server as a background service.</p> <p class="p">See the BaseX command-line options documentation for details. </p> <div class="p">To start the BaseX HTTP server: <ul class="ul" id="topic_ayl_c3j_lr__ul_j5x_hkj_lr"> <li class="li">OS X or Linux: Run the command <samp class="ph codeph">basexhttp -B</samp> to start the server as a background service.</li> <li class="li">Windows: Use the "Start BaseX server" item in the BaseX start menu or run the command <samp class="ph codeph">basexhttp -B</samp> </li> </ul></div> <p class="p">Once you have the HTTP server running you can connect to it in serveral ways, including using WebDAV, either from OxygenXML or from another WebDAV client. You should be able to set up the database as a WebDAV shared drive under all operating systems. See the BaseX documentation for details.</p> <p class="p">The D4ST git commit hooks use the BaseX command-line client to connect to the BaseX server. The D4ST DITA link management Web application is accessed via normal HTTP through a Web browser.</p> </div> </section> <section class="topic" id="topic_lgq_nfk_lr"> <h2 class="title topictitle2">Create a BaseX Database and Load Some DITA Content</h2> <div class="body"> <p class="p">The BaseX server can manage any number of databases. A database is simply a named collection of XML documents.</p> <div class="p">To test the BaseX setup you can try loading the "garage" samples that come with the Open Toolkit:<ol class="ol" id="topic_lgq_nfk_lr__ol_al2_klk_lr"> <li class="li">Open a command window and run the command <samp class="ph codeph">basexclient</samp>.<p class="p">You should be prompted to enter the BaseX user ID and password (e.g., "admin", "admin").</p><p class="p">If the command does not work, check your PATH environment variable or change directories to the BaseX <span class="ph filepath">bin/</span> directory.</p><div class="p">Once you have logged in you should see the BaseX command prompt:<pre class="pre codeblock">c:\&gt;basexclient
Username: admin
Password:
BaseX 8.0.3 [Client]
Try help to get more information.

&gt;</pre></div></li> <li class="li">Create a new database to hold the sample documents:<pre class="pre codeblock">&gt; <strong class="ph b">create database samples</strong>
Database 'samples' created in 23.95 ms.
&gt;</pre></li> <li class="li">Use the <span class="keyword cmdname">list</span> command to list the databases available:<pre class="pre codeblock">&gt; <strong class="ph b">list</strong>
Name     Resources  Size  Input Path
------------------------------------
samples  0          4532

1 database(s).
&gt;</pre></li> <li class="li">Open the "samples" database to make it the current database:<pre class="pre codeblock">&gt; <strong class="ph b">open samples</strong>
Database 'samples' was opened in 0.02 ms.
&gt;</pre></li> <li class="li">Add the samples documents to the database:<pre class="pre codeblock">&gt; <strong class="ph b">add to samples c:\Program Files\Oxygen XML Editor 16\frameworks\dita\DITA-OT\samples</strong>
Resource(s) added in 2092.7 ms.
&gt;</pre><p class="p">Set the directory to wherever your Open Toolkit actually is.</p><p class="p">The "<samp class="ph codeph">to samples</samp>" part of the command adds the documents in the <span class="ph filepath">samples</span> folder to a directory named "samples" in the database.</p><p class="p">It should take a few seconds to load the documents. If the load was instantaneous, then the catalog and DTD parsing are not set up correctly.</p></li> <li class="li">List the files in the database:<pre class="pre codeblock">&gt; <strong class="ph b">list samples</strong>
Input Path                                    Type  Content-Type     Size
-------------------------------------------------------------------------
samples/ant_sample/sample_all.xml             xml   application/xml  57
samples/ant_sample/sample_docbook.xml         xml   application/xml  42
samples/ant_sample/sample_eclipsehelp.xml     xml   application/xml  42
samples/ant_sample/sample_htmlhelp.xml        xml   application/xml  42
samples/ant_sample/sample_javahelp.xml        xml   application/xml  42
samples/ant_sample/sample_odt.xml             xml   application/xml  42
samples/ant_sample/sample_pdf.xml             xml   application/xml  42
samples/ant_sample/sample_tocjs.xml           xml   application/xml  42
samples/ant_sample/sample_troff.xml           xml   application/xml  42
samples/ant_sample/sample_wordrtf.xml         xml   application/xml  42
samples/ant_sample/sample_xhtml.xml           xml   application/xml  54
samples/ant_sample/sample_xhtml_plus_css.xml  xml   application/xml  73
samples/ant_sample/template_docbook.xml       xml   application/xml  38
samples/ant_sample/template_eclipsehelp.xml   xml   application/xml  38
samples/ant_sample/template_htmlhelp.xml      xml   application/xml  38
samples/ant_sample/template_javahelp.xml      xml   application/xml  38
samples/ant_sample/template_odt.xml           xml   application/xml  38
samples/ant_sample/template_pdf.xml           xml   application/xml  38
samples/ant_sample/template_wordrtf.xml       xml   application/xml  38
samples/ant_sample/template_xhtml.xml         xml   application/xml  37
samples/concepts/garageconceptsoverview.xml   xml   application/xml  17
samples/concepts/lawnmower.xml                xml   application/xml  20
samples/concepts/oil.xml                      xml   application/xml  27
samples/concepts/paint.xml                    xml   application/xml  27
samples/concepts/shelving.xml                 xml   application/xml  27
samples/concepts/snowshovel.xml               xml   application/xml  27
samples/concepts/toolbox.xml                  xml   application/xml  32
samples/concepts/tools.xml                    xml   application/xml  67
samples/concepts/waterhose.xml                xml   application/xml  27
samples/concepts/wheelbarrow.xml              xml   application/xml  17
samples/concepts/workbench.xml                xml   application/xml  24
samples/concepts/wwfluid.xml                  xml   application/xml  20
samples/tasks/changingtheoil.xml              xml   application/xml  69
samples/tasks/garagetaskoverview.xml          xml   application/xml  17
samples/tasks/organizing.xml                  xml   application/xml  17
samples/tasks/shovellingsnow.xml              xml   application/xml  47
samples/tasks/spraypainting.xml               xml   application/xml  56
samples/tasks/takinggarbage.xml               xml   application/xml  39
samples/tasks/washingthecar.xml               xml   application/xml  68

Resources.
&gt;</pre></li> <li class="li">Verify that the @class attributes were correctly expanded:<pre class="pre codeblock">&gt; <strong class="ph b">xquery /*/@class</strong>
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic concept/concept "
class="- topic/topic task/task "
class="- topic/topic concept/concept "
class="- topic/topic task/task "
class="- topic/topic task/task "
class="- topic/topic task/task "
class="- topic/topic task/task "
class="- topic/topic task/task "
Query executed in 2.57 ms.
&gt;</pre><p class="p">This XQuery simply returns all the @class attributes of all the root elements in the database. If those elements have @class attributes then all the elements will.</p></li> </ol></div> <p class="p">You have now verified that your BaseX server is correctly configured to manage DITA documents and is ready to get updates from your git repository.</p> <div class="p">If you want, you can remove the samples database:<pre class="pre codeblock">&gt; <strong class="ph b">drop database samples</strong>
Database 'samples' was dropped.
&gt; list
Name  Resources  Size  Input Path
---------------------------------

0 database(s).
&gt;</pre></div> </div> </section> <section class="topic" id="topic_ann_zqk_lr"> <h2 class="title topictitle2">Install D4ST XQuery Modules</h2> <div class="body"> <p class="p">The D4ST XQuery modules provide the DITA-specific link management and DITA-aware searching features you need.</p> <div class="p">To install the modules, you run the script <span class="ph filepath">install-modules.sh</span> or <span class="ph filepath">install-modules.bat</span> from the <span class="ph filepath">basex/scripts</span> directory:<ol class="ol" id="topic_ann_zqk_lr__ol_fkh_crk_lr"> <li class="li">Open a command window and navigate to the <span class="ph filepath">basex/scripts/</span> directory:<pre class="pre codeblock">c:\&gt;cd c:\projects\dita-for-small-teams\basex\scripts
</pre><p class="p">Or</p><pre class="pre codeblock">
c:\projects\dita-for-small-teams\basex\scripts&gt;</pre></li> <li class="li">Run the <span class="ph filepath">install-modules</span> script:<pre class="pre codeblock">c:\projects\dita-for-small-teams\basex\scripts&gt;install-modules.bat admin admin
Installing D4ST XQuery packages:
Name                                                   Version  Type      Path
-----------------------------------------------------------------------------------------------------------------------------------
org.dita-for-small-teams.xquery.modules.dita-utils     -        Internal  org/dita-for-small-teams/xquery/modules/dita-utils.xqm
org.dita-for-small-teams.xquery.modules.relpath-utils  -        Internal  org/dita-for-small-teams/xquery/modules/relpath-utils.xqm

2 package(s).

c:\projects\dita-for-small-teams\basex\scripts&gt;</pre></li> </ol></div> </div> </section> <section class="topic" id="topic_chf_my2_lr"> <h2 class="title topictitle2">Set Up Git Commit Hooks for BaseX Update</h2> <div class="body"> <p class="p">The D4ST git commit hooks for BaseX keep BaseX in sync with your git repository.</p> <div class="p">Using the commit requires the following:<ul class="ul" id="topic_chf_my2_lr__ul_xmz_zs5_mr"> <li class="li">The BaseX <span class="ph filepath">bin/</span> directory must be in your PATH or Path environment variable. You should be able to type "basex" or "basexclient" on the command line. This allows the git hook scripts to run the required BaseX commands. You should have set this up when you installed BaseX.</li> <li class="li">The BaseX server connection properties must be set in the <span class="ph filepath">.basex</span> file. This file can be in the main BaseX installation directory or in your user home directory. This allows the basexclient command to connect and authenticate to the BaseX server without the need for a separate configuration file.</li> <li class="li">The D4ST git hooks must be copied to or linked from the <span class="ph filepath">.git/hooks/</span> directory in the git repositories you want to manage. These hooks keep the BaseX databases in sync with your git repositories.</li> </ul></div> <div class="p">To set up the git hooks, do the following:<ol class="ol" id="topic_chf_my2_lr__ol_oh1_xs5_mr"> <li class="li">Edit the <span class="ph filepath">.basex</span> configuration file, either in the main BaseX installation directory or in your home directory, and add the following settings:<pre class="pre codeblock">USER = admin
PASSWORD = admin
HOST = localhost
PORT = 1984</pre><p class="p">These values are the BaseX default. Your configuration must reflect any changes you made from default after you installed BaseX.</p><p class="p">For OS X: If you want to put the <span class="ph filepath">.basex</span> configuration file in your home directory, you must delete the <span class="ph filepath">.basexhome</span> from the BaseX installation directory, otherwise BaseX will not read the <span class="ph filepath">.basex</span> file in your home directory.</p></li> <li class="li">Copy the files from the D4ST project <span class="ph filepath">commit-hooks/git/</span> directory to the <span class="ph filepath">.git/hooks</span> directory under the root directory of your git repository.<div class="p">For OS X and Linux: Instead of copying the files you can link to the files in the D4ST project. This makes it easier to keep the hooks updated. To do this, use the <span class="keyword cmdname">ln -s</span> command like so:<pre class="pre codeblock">ekimber:project-01$ cd .git/hooks
ekimber:hooks$ ln -s ~/dita-for-small-teams/commit-hooks/git/basexLoadOrUpdateBranch
ekimber:hooks$ ln -s ~/dita-for-small-teams/commit-hooks/git/post-checkout
ekimber:hooks$ ln -s ~/dita-for-small-teams/commit-hooks/git/post-commit
ekimber:hooks$ ln -s ~/dita-for-small-teams/commit-hooks/git/post-merge
ekimber:hooks$ ln -s ~/dita-for-small-teams/commit-hooks/git/recordGitStateDetails
ekimber:hooks$ ln -s ~/dita-for-small-teams/commit-hooks/git/updateBaseXForCOmmitOrMerge</pre></div><div class="p">For OS X and Linux: Make sure all the commit hook files are executeable. They should be as they come from the D4ST git repository but they may not be for whatever reason. To make them executable, apply this command to the directory that contains the scripts:<pre class="pre codeblock">ekimber:dita-for-small-teams$ chmod a+x commit-hooks/git/*</pre></div></li> </ol></div> </div> </section> <footer id="topicsNPLinks"><div id="footer_previous"><a href="../topics/tools-git.html" class="previous" rel="internal">git: Distributed and Shared Access to Content</a></div><div id="footer_next"><a href="../topics/tools-exist-db.html" class="next" rel="internal">eXist-db: Enabling Search and Link Management</a></div></footer></div></section></article><div class="clear"></div></div><div class="clearfix"></div></div><div class="clearfix"></div><div id="footer-container" class="grid_12"></div></div></body></html>